!function(){"use strict";var a=angular.module("eha.ums-auth",["eha.ums-auth.http-interceptor","eha.ums-auth.auth.service","eha.ums-auth.show-for-role.directive","eha.ums-auth.show-authenticated.directive"]);"undefined"!=typeof module&&module.exports&&(module.exports=a)}(),function(){"use strict";var a=angular.module("eha.ums-auth.auth.service",["restangular"]);a.provider("ehaUMSAuthService",["ehaUMSAuthHttpInterceptorProvider","$httpProvider",function(a,b){function c(a){return a.charAt(0).toUpperCase()+a.slice(1)}function d(a){var b=[a];return a.indexOf("-")>-1?b=a.split("-"):a.indexOf("_")>-1&&(b=a.split("_")),b=b.map(c),b.join("")}function e(a,b,c){return a.getCurrentUser().then(function(d){return!d||d.isAdmin()||d.hasRole(c)?d:(a.trigger(EHA_UMS_AUTH_UNAUTHORISED_EVENT),b.reject(EHA_UMS_AUTH_UNAUTHORISED_EVENT))})}var f={adminRoles:["_admin"],sessionEndpoint:"_session"};this.config=function(c){f=angular.extend(f,c),c.interceptor&&(a.config(c.interceptor),b.interceptors.push("ehaUMSAuthHttpInterceptor")),c.userRoles&&c.userRoles.forEach(function(a){var b="require"+d(a)+"User";this[b]=function(b,c){return e(b,c,[a])}}.bind(this))},this.requireAdminUser=function(a,b){return e(a,b,f.adminRoles)},this.requireAuthenticatedUser=function(a,b){return a.getCurrentUser()},this.requireUserWithRoles=function(a){return function(b,c){return e(b,c,a)}},this.$get=["Restangular","$log","$q","$rootScope","$window","EHA_UMS_AUTH_UNAUTHORISED_EVENT","EHA_UMS_AUTH_UNAUTHENTICATED_EVENT",function(a,b,c,d,e,g,h){function i(a){return function(){e.location.assign(a)}}function j(){var b=f.sessionEndpoint;return c.when(a.oneUrl("session",b).get()).then(function(a){var b=a.userCtx;return b?b:c.reject("User context not found")}).catch(function(){return q(h),c.reject(h)})}function k(a){return a.hasRole=function(b){if(angular.isArray(b)){var c=b.filter(function(b){return a.roles.indexOf(b)>-1});return!!c.length}if(angular.isString(b))return a.roles.indexOf(b)>-1},a.isAdmin=function(){return a.hasRole(f.adminRoles)},["name","role"].forEach(function(b){var c=b+"Getter";a[c]=function(){return a[b]}}),a}function l(){return n?c.when(n):j().then(function(a){return n=k(a)}).catch(function(a){return b.debug(a),c.reject(a)})}function m(a){return function(b){return r.getCurrentUser().then(function(d){var e=a(d,b);return!!e||(r.trigger(g),c.reject(g))})}}var n,o=(a.withConfig(function(a){a.setBaseUrl(f.url),f.defaultHttpFields&&a.setDefaultHttpFields(f.defaultHttpFields)}),i("/login")),p=d.$new(!0),q=p.$broadcast.bind(p);p.$on(h,o);var r={getSession:j,getCurrentUser:l,on:p.$on.bind(p),trigger:q,isAuthenticated:function(){return n?j():c.reject()},login:o,logout:i("/logout"),unsafeGetCurrentUserSynchronously:function(){return n}};return r.requireUserWithAnyRole=m(function(a,b){return b.reduce(function(b,c){return b||a.hasRole(c)},!1)}),r.anyRoleExcept=m(function(a,b){return f.userRoles.reduce(function(c,d){return c||d!==b&&a.hasRole(d)},!1)}),r}]}]),"undefined"!=typeof module&&module.exports&&(module.exports=a)}(),function(){"use strict";function a(a,b){function c(b){var c=a.hosts;if(c){var d=a.hosts.filter(function(a){return b.indexOf(a)>-1});return!!d.length}return!0}var d=b.get("$q"),e=(b.get("$log"),b.get("EHA_UMS_AUTH_UNAUTHENTICATED_EVENT"));return{responseError:function(a){if(401===a.status&&c(a.config.url)){var f=b.get("ehaUMSAuthService");f.trigger(e)}return d.reject(a)}}}var b=angular.module("eha.ums-auth.http-interceptor",[]);b.provider("ehaUMSAuthHttpInterceptor",function(){var b={};this.config=function(a){b=a},this.$get=["$injector",function(c){return new a(b,c)}]}),"undefined"!=typeof module&&module.exports&&(module.exports=b)}(),angular.module("eha.ums-auth.show-for-role.directive",[]).directive("ehaShowForRole",["ehaUMSAuthService","$animate","$parse","$q","$log",function(a,b,c,d,e){var f="ng-hide",g="ng-hide-animate";return{restrict:"A",link:function(h,i,j){function k(c){a.getCurrentUser().then(function(a){return a&&(a.hasRole(c)||a.isAdmin())?(b.removeClass(i,f,{tempClasses:g}),!0):d.reject("Role not found")}).catch(function(a){e.debug(a),b.addClass(i,f,{tempClasses:g})})}i.addClass("ng-hide");var l,m=c(j.ehaShowForRole)(h);if(angular.isArray(m))l=m;else{if(!angular.isString(m))throw Error("You must pass a string or an array of strings");l=[m]}k(l),a.on("authenticationStateChange",function(){k(l)})}}}]),angular.module("eha.ums-auth.show-authenticated.directive",[]).directive("ehaShowAuthenticated",["ehaUMSAuthService","$animate",function(a,b){var c="ng-hide",d="ng-hide-animate";return{restrict:"A",link:function(e,f){function g(){a.isAuthenticated().then(function(){b.removeClass(f,c,{tempClasses:d})}).catch(function(){b.addClass(f,c,{tempClasses:d})})}f.addClass("ng-hide"),g(),a.on("authenticationStateChange",g)}}}]),["unauthenticated","unauthorised"].forEach(function(a){var b=a.toUpperCase(),c="EHA_UMS_AUTH_"+b+"_EVENT";angular.module("eha.ums-auth").constant(c,c)});